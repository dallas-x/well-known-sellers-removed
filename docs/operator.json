{
  "RoleName":"SYFFlowOperatorRole",
  "AssumeRolePolicyDocument":{
    "Version":"2012-10-17",
    "Statement":[{
      "Effect":"Allow",
      "Principal":{"AWS":"arn:aws:iam::111122223333:root"},
      "Action":"sts:AssumeRole",
      "Condition":{"StringEquals":{"aws:PrincipalTag/Role":"FlowOperator"}}
    }]
  },
  "Description":"Operational access to monitor pipelines, restart EC2, run Glue jobs, and manage buckets",
  "Policies":[
    {
      "PolicyName":"FlowOperator-S3-Monitoring",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[
          {
            "Sid":"ListAllBuckets",
            "Effect":"Allow",
            "Action":["s3:ListAllMyBuckets"],
            "Resource":"*"
          },
          {
            "Sid":"GetAllRelevantObjects",
            "Effect":"Allow",
            "Action":["s3:GetObject","s3:ListBucket"],
            "Resource":[
              "arn:aws:s3:::nexus",
              "arn:aws:s3:::nexus/*"
            ]
          },
          {
            "Sid":"DenyWritesToCuratedAndRaw",
            "Effect":"Deny",
            "Action":["s3:PutObject","s3:DeleteObject"],
            "Resource":[
              "arn:aws:s3:::nexus/raw-archive/*",
              "arn:aws:s3:::nexus/silver-lake/*"
            ]
          }
        ]
      }
    },
    {
      "PolicyName":"FlowOperator-Glue-Execute",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[
          {
            "Sid":"GlueRunJobs",
            "Effect":"Allow",
            "Action":["glue:StartJobRun","glue:BatchStopJobRun","glue:GetJobRun","glue:GetJobRuns"],
            "Resource":"arn:aws:glue:us-west-2:111122223333:job/*"
          },
          {
            "Sid":"GlueReadDefinitions",
            "Effect":"Allow",
            "Action":["glue:GetJob","glue:GetJobs","glue:GetTable","glue:GetTables"],
            "Resource":"*"
          }
        ]
      }
    },
    {
      "PolicyName":"FlowOperator-EC2-Manage",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[
          {
            "Sid":"DescribeAndRestartEC2",
            "Effect":"Allow",
            "Action":[
              "ec2:DescribeInstances","ec2:DescribeInstanceStatus",
              "ec2:StartInstances","ec2:StopInstances","ec2:RebootInstances",
              "ec2:GetConsoleOutput"
            ],
            "Resource":"arn:aws:ec2:us-west-2:111122223333:instance/*"
          },
          {
            "Sid":"SSMSessionAndCommands",
            "Effect":"Allow",
            "Action":[
              "ssm:StartSession","ssm:SendCommand",
              "ssm:ListCommands","ssm:GetCommandInvocation",
              "ssm:DescribeInstanceInformation"
            ],
            "Resource":[
              "arn:aws:ec2:us-west-2:111122223333:instance/*",
              "arn:aws:ssm:us-west-2:111122223333:document/AWS-RunShellScript"
            ]
          }
        ]
      }
    },
    {
      "PolicyName":"FlowOperator-CloudWatch",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[{
          "Effect":"Allow",
          "Action":[
            "logs:CreateLogGroup","logs:CreateLogStream",
            "logs:PutLogEvents","cloudwatch:DescribeAlarms","cloudwatch:GetMetricData"
          ],
          "Resource":"*"
        }]
      }
    }
  ]
}
