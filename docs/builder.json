{
  "RoleName":"SYFStreamBuilderRole",
  "AssumeRolePolicyDocument":{
    "Version":"2012-10-17",
    "Statement":[{
      "Effect":"Allow",
      "Principal":{"AWS":"arn:aws:iam::111122223333:root"},
      "Action":"sts:AssumeRole",
      "Condition":{"StringEquals":{"aws:PrincipalTag/Role":"StreamBuilder"}}
    }]
  },
  "Description":"Dev-level access to build pipelines, Glue jobs, Firehose, and manage S3 buckets",
  "Policies":[
    {
      "PolicyName":"StreamBuilder-S3-Access",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[
          {
            "Sid":"ListRelevantBuckets",
            "Effect":"Allow",
            "Action":["s3:ListAllMyBuckets"],
            "Resource":"*"
          },
          {
            "Sid":"CreateAndDeleteBuckets",
            "Effect":"Allow",
            "Action":["s3:CreateBucket","s3:DeleteBucket"],
            "Resource":"*"
          },
          {
            "Sid":"ListDevAndReadZones",
            "Effect":"Allow",
            "Action":["s3:ListBucket"],
            "Resource":"arn:aws:s3:::nexus",
            "Condition":{
              "StringLike":{"s3:prefix":["lab-workshop/*","analytics-hub/*","silver-lake/*"]},
              "StringEquals":{"aws:sourceVpce":"<YOUR_VPCE_ID>"}
            }
          },
          {
            "Sid":"RWDevAndAnalytics",
            "Effect":"Allow",
            "Action":["s3:GetObject","s3:PutObject","s3:DeleteObject"],
            "Resource":[
              "arn:aws:s3:::nexus/lab-workshop/*",
              "arn:aws:s3:::nexus/analytics-hub/*"
            ],
            "Condition":{"StringEquals":{"aws:sourceVpce":"<YOUR_VPCE_ID>"}}
          },
          {
            "Sid":"ReadCurated",
            "Effect":"Allow",
            "Action":["s3:GetObject"],
            "Resource":"arn:aws:s3:::nexus/silver-lake/*",
            "Condition":{"StringEquals":{"aws:sourceVpce":"<YOUR_VPCE_ID>"}}
          },
          {
            "Sid":"DenyWritesToRawAndPlayground",
            "Effect":"Deny",
            "Action":["s3:PutObject","s3:DeleteObject"],
            "Resource":[
              "arn:aws:s3:::nexus/raw-archive/*",
              "arn:aws:s3:::nexus/playground/*"
            ]
          }
        ]
      }
    },
    {
      "PolicyName":"StreamBuilder-Glue-Author",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[
          {
            "Sid":"GlueJobCRUD",
            "Effect":"Allow",
            "Action":[
              "glue:CreateJob","glue:UpdateJob","glue:DeleteJob",
              "glue:GetJob","glue:GetJobs","glue:GetJobRuns"
            ],
            "Resource":"arn:aws:glue:us-west-2:111122223333:job/*"
          },
          {
            "Sid":"GlueTableCRUD",
            "Effect":"Allow",
            "Action":[
              "glue:CreateTable","glue:UpdateTable","glue:DeleteTable",
              "glue:GetTable","glue:GetTables"
            ],
            "Resource":[
              "arn:aws:glue:us-west-2:111122223333:catalog",
              "arn:aws:glue:us-west-2:111122223333:database/*",
              "arn:aws:glue:us-west-2:111122223333:table/*/*"
            ]
          }
        ]
      }
    },
    {
      "PolicyName":"StreamBuilder-Athena-Query",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[{
          "Effect":"Allow",
          "Action":[
            "athena:StartQueryExecution","athena:GetQueryResults",
            "athena:GetQueryExecution","athena:ListDatabases",
            "athena:ListTableMetadata"
          ],
          "Resource":"*"
        }]
      }
    },
    {
      "PolicyName":"StreamBuilder-Firehose",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[{
          "Effect":"Allow",
          "Action":[
            "firehose:CreateDeliveryStream","firehose:DeleteDeliveryStream",
            "firehose:UpdateDestination","firehose:DescribeDeliveryStream",
            "firehose:PutRecord","firehose:PutRecordBatch"
          ],
          "Resource":"arn:aws:firehose:us-west-2:111122223333:deliverystream/*"
        }]
      }
    },
    {
      "PolicyName":"StreamBuilder-Lambda-Invoke",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[{
          "Effect":"Allow",
          "Action":["lambda:InvokeFunction","lambda:GetFunctionConfiguration"],
          "Resource":"arn:aws:lambda:us-west-2:111122223333:function:*"
        }]
      }
    },
    {
      "PolicyName":"StreamBuilder-CloudWatch",
      "PolicyDocument":{
        "Version":"2012-10-17",
        "Statement":[{
          "Effect":"Allow",
          "Action":[
            "cloudwatch:PutMetricAlarm","cloudwatch:DescribeAlarms",
            "logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"
          ],
          "Resource":"*"
        }]
      }
    }
  ]
}
